<?xml version="1.0" encoding="UTF-8"?>
<!-- Do not edit this file with editors other than diagrams.net -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1441px" height="827px" viewBox="-0.5 -0.5 1441 827" content="&lt;mxfile host=&quot;drawio-plugin&quot; modified=&quot;2022-04-29T10:33:29.388Z&quot; agent=&quot;5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.45 Safari/537.36&quot; etag=&quot;8CO8hRztWcZXiODgI5Vw&quot; version=&quot;15.5.4&quot; type=&quot;embed&quot;&gt;&lt;diagram id=&quot;23iRSUPoRavnBvh4doch&quot; name=&quot;NonRecursiveMutex_fix&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;"><defs/><g><ellipse cx="445" cy="417.5" rx="45" ry="30" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 88px; height: 1px; padding-top: 418px; margin-left: 401px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">object1</div></div></div></foreignObject><text x="445" y="421" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">object1</text></switch></g><rect x="240" y="400" width="100" height="70" fill="#ffffff" stroke="#000000" pointer-events="all"/><path d="M 240 435 M 340 435 L 340 435" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 240 400 M 340 400 M 340 435 M 240 435" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 240 400 M 340 400 M 340 435 M 240 435" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 418px; margin-left: 241px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 31px; overflow: hidden;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">pointer</div></div></div></foreignObject><text x="290" y="421" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">pointer</text></switch></g><path d="M 240 435 M 340 435 M 340 470 M 240 470" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 240 435 M 340 435 M 340 470 M 240 470" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 453px; margin-left: 241px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 31px; overflow: hidden;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">count = 2</div></div></div></foreignObject><text x="290" y="456" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">count = 2</text></switch></g><path d="M 160 375 L 200 375 L 200 417.5 L 233.63 417.5" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 238.88 417.5 L 231.88 421 L 233.63 417.5 L 231.88 414 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="80" y="360" width="80" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 375px; margin-left: 81px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">globalPtr</div></div></div></foreignObject><text x="120" y="379" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">globalPtr</text></switch></g><path d="M 160 455 L 200 455 L 200 417.5 L 233.63 417.5" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 238.88 417.5 L 231.88 421 L 233.63 417.5 L 231.88 414 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="80" y="440" width="80" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 455px; margin-left: 81px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">localPtr</div></div></div></foreignObject><text x="120" y="459" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">localPtr</text></switch></g><path d="M 340 417.5 L 393.63 417.5" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 398.88 417.5 L 391.88 421 L 393.63 417.5 L 391.88 414 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="445" cy="752.5" rx="45" ry="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 88px; height: 1px; padding-top: 753px; margin-left: 401px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">object2</div></div></div></foreignObject><text x="445" y="756" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">object2</text></switch></g><rect x="240" y="625" width="100" height="70" fill="#ffffff" stroke="#000000" pointer-events="none"/><path d="M 240 660 M 340 660 L 340 660" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 240 625 M 340 625 M 340 660 M 240 660" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 240 625 M 340 625 M 340 660 M 240 660" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 643px; margin-left: 241px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 31px; overflow: hidden;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">pointer</div></div></div></foreignObject><text x="290" y="646" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">pointer</text></switch></g><path d="M 240 660 M 340 660 M 340 695 M 240 695" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 240 660 M 340 660 M 340 695 M 240 695" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 678px; margin-left: 241px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 31px; overflow: hidden;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">count = 1</div></div></div></foreignObject><text x="290" y="681" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">count = 1</text></switch></g><path d="M 160 642.5 L 233.63 642.5" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 238.88 642.5 L 231.88 646 L 233.63 642.5 L 231.88 639 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="80" y="627.5" width="80" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 643px; margin-left: 81px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">localPtr</div></div></div></foreignObject><text x="120" y="646" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">localPtr</text></switch></g><path d="M 340 642.5 L 393.63 642.5" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 398.88 642.5 L 391.88 646 L 393.63 642.5 L 391.88 639 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 410px; margin-left: 20px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: nowrap;">read</div></div></div></foreignObject><text x="20" y="414" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">read</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 708px; margin-left: 20px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: nowrap;">write</div></div></div></foreignObject><text x="20" y="711" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">write</text></switch></g><rect x="240" y="735" width="100" height="70" fill="#ffffff" stroke="#000000" pointer-events="none"/><path d="M 240 770 M 340 770 L 340 770" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 240 735 M 340 735 M 340 770 M 240 770" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 240 735 M 340 735 M 340 770 M 240 770" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 753px; margin-left: 241px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 31px; overflow: hidden;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">pointer</div></div></div></foreignObject><text x="290" y="756" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">pointer</text></switch></g><path d="M 240 770 M 340 770 M 340 805 M 240 805" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 240 770 M 340 770 M 340 805 M 240 805" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 788px; margin-left: 241px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 31px; overflow: hidden;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">count = 1</div></div></div></foreignObject><text x="290" y="791" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">count = 1</text></switch></g><path d="M 160 752.5 L 233.63 752.5" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 238.88 752.5 L 231.88 756 L 233.63 752.5 L 231.88 749 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="80" y="737.5" width="80" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 753px; margin-left: 81px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">globalPtr</div></div></div></foreignObject><text x="120" y="756" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">globalPtr</text></switch></g><path d="M 340 752.5 L 393.63 752.5" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 398.88 752.5 L 391.88 756 L 393.63 752.5 L 391.88 749 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="445" cy="642.5" rx="45" ry="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 88px; height: 1px; padding-top: 643px; margin-left: 401px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">object1</div></div></div></foreignObject><text x="445" y="646" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">object1</text></switch></g><path d="M 60 350 L 55 350 Q 50 350 50 360 L 50 400 Q 50 410 45 410 L 42.5 410 Q 40 410 45 410 L 47.5 410 Q 50 410 50 420 L 50 460 Q 50 470 55 470 L 60 470" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 60 600 L 55 600 Q 50 600 50 610 L 50 697.5 Q 50 707.5 45 707.5 L 42.5 707.5 Q 40 707.5 45 707.5 L 47.5 707.5 Q 50 707.5 50 717.5 L 50 805 Q 50 815 55 815 L 60 815" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 298px; height: 1px; padding-top: 387px; margin-left: 522px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;"><div id="_SJ5jTEjm" class="editor-block code-line-block focused"><div class="block-content text-element"><span class="editor-text-node">void </span><span class="style-token style-function">read</span><span class="style-token style-punctuation">(</span><span class="style-token style-punctuation">)</span><span class="editor-text-node"> </span><span class="style-token style-punctuation">{</span></div></div><div id="_Uoc4uWF9" class="editor-block code-line-block"><div class="block-content text-element"><span class="editor-text-node">    shared_ptr </span><span class="style-token style-operator">&lt;</span><span class="editor-text-node">Foo</span><span class="style-token style-operator">&gt;</span><span class="editor-text-node"> localPtr</span><span class="style-token style-punctuation">;</span></div></div><div id="_H6IhvZpO" class="editor-block code-line-block"><div class="block-content text-element"><span class="editor-text-node">    </span><span class="style-token style-punctuation">{</span></div></div><div id="_8XcUF5yM" class="editor-block code-line-block"><div class="block-content text-element"><span class="editor-text-node">        MutexLockGuard </span><span class="style-token style-function">lock</span><span class="style-token style-punctuation">(</span><span class="editor-text-node">mutex</span><span class="style-token style-punctuation">)</span><span class="style-token style-punctuation">;</span></div></div><div id="_kg8oqRZZ" class="editor-block code-line-block"><div class="block-content text-element"><span class="editor-text-node">        localPtr </span><span class="style-token style-operator">=</span><span class="editor-text-node"> globalPtr</span><span class="style-token style-punctuation">;</span><span class="editor-text-node">  </span><span class="style-token style-comment">// read globalPtr</span></div></div><div id="_yDrGw_O_" class="editor-block code-line-block"><div class="block-content text-element"><span class="editor-text-node">    </span><span class="style-token style-punctuation">}</span></div></div><div id="_zPgsTH9t" class="editor-block code-line-block"><div class="block-content text-element"><span class="editor-text-node">    </span><span class="style-token style-comment">// use localPtr since here，读写localPtr也无须加锁</span></div></div><div id="_w1oGkKbm" class="editor-block code-line-block"><div class="block-content text-element"><span class="editor-text-node">    </span><span class="style-token style-function">doit</span><span class="style-token style-punctuation">(</span><span class="editor-text-node">localPtr</span><span class="style-token style-punctuation">)</span><span class="style-token style-punctuation">;</span></div></div><div id="_L4IhuJMb" class="editor-block code-line-block"><div class="block-content text-element"><span class="style-token style-punctuation">}</span></div></div></div></div></div></foreignObject><text x="522" y="399" fill="#000000" font-family="Helvetica" font-size="12px">void read() {...</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 418px; height: 1px; padding-top: 632px; margin-left: 522px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;"><div id="_81poGPYq" class="editor-block code-line-block focused"><div class="block-content text-element"><span class="editor-text-node">void </span><span class="style-token style-function">write</span><span class="style-token style-punctuation">(</span><span class="style-token style-punctuation">)</span><span class="editor-text-node"> </span><span class="style-token style-punctuation">{</span></div></div><div id="_druir53n" class="editor-block code-line-block"><div class="block-content text-element"><span class="editor-text-node">    shared_ptr </span><span class="style-token style-operator">&lt;</span><span class="editor-text-node">Foo</span><span class="style-token style-operator">&gt;</span><span class="editor-text-node"> </span><span class="style-token style-function">newPtr</span><span class="style-token style-punctuation">(</span><span class="style-token style-keyword">new</span><span class="editor-text-node"> </span><span class="style-token style-class-name">Foo</span><span class="style-token style-punctuation">)</span><span class="style-token style-punctuation">;</span><span class="editor-text-node">  </span><span class="style-token style-comment">// 注意，对象的创建在临界区之外  </span></div></div><div id="_Ldo4Wt1O" class="editor-block code-line-block"><div class="block-content text-element"><span class="editor-text-node">    </span><span class="style-token style-punctuation">{</span></div></div><div id="_stZJLjs1" class="editor-block code-line-block"><div class="block-content text-element"><span class="editor-text-node">        MutexLockGuard </span><span class="style-token style-function">lock</span><span class="style-token style-punctuation">(</span><span class="editor-text-node">mutex</span><span class="style-token style-punctuation">)</span><span class="style-token style-punctuation">;</span></div></div><div id="_VUOhazBI" class="editor-block code-line-block"><div class="block-content text-element"><span class="editor-text-node">        globalPtr </span><span class="style-token style-operator">=</span><span class="editor-text-node"> newPtr</span><span class="style-token style-punctuation">;</span><span class="editor-text-node">  </span><span class="style-token style-comment">// write to globalPtr  </span></div></div><div id="_1L0tDEEv" class="editor-block code-line-block"><div class="block-content text-element"><span class="editor-text-node">    </span><span class="style-token style-punctuation">}</span><span class="editor-text-node">  </span></div></div><div id="_C0KR1atF" class="editor-block code-line-block"><div class="block-content text-element"><span class="editor-text-node">    </span><span class="style-token style-comment">// use newPtr since here，读写newPtr无须加锁</span></div></div><div id="_Kx1oVnSd" class="editor-block code-line-block"><div class="block-content text-element"><span class="editor-text-node">    </span><span class="style-token style-function">doit</span><span class="style-token style-punctuation">(</span><span class="editor-text-node">newPtr</span><span class="style-token style-punctuation">)</span><span class="style-token style-punctuation">;</span></div></div><div id="_YLCyyiVH" class="editor-block code-line-block"><div class="block-content text-element"><span class="style-token style-punctuation">}</span></div></div></div></div></div></foreignObject><text x="522" y="644" fill="#000000" font-family="Helvetica" font-size="12px">void write() {...</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 298px; height: 1px; padding-top: 227px; margin-left: 522px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;"><div id="_2y_aZpqN" class="editor-block code-line-block hover focused"><div class="block-content text-element"><span class="editor-text-node">MutexLock mutex</span><span class="style-token style-punctuation">;</span><span class="editor-text-node"> </span><span class="style-token style-comment">// No need for ReaderWriterLock</span></div></div><div id="_OJqBLW4E" class="editor-block code-line-block"><div class="block-content text-element"><span class="editor-text-node">shared_ptr</span><span class="style-token style-operator">&lt;</span><span class="editor-text-node">Foo</span><span class="style-token style-operator">&gt;</span><span class="editor-text-node"> globalPtr</span><span class="style-token style-punctuation">;</span></div></div><div id="_x0W2XdBA" class="editor-block code-line-block empty-block"><div class="block-content text-element"><br /></div></div><div id="_FiBDJkoQ" class="editor-block code-line-block"><div class="block-content text-element"><span class="style-token style-comment">// 我们的任务是把 globalPtr 安全地传给 doit()</span></div></div><div id="_OXJ4Wcr9" class="editor-block code-line-block"><div class="block-content text-element"><span class="editor-text-node">void </span><span class="style-token style-function">doit</span><span class="style-token style-punctuation">(</span><span class="editor-text-node">const shared_ptr</span><span class="style-token style-operator">&lt;</span><span class="editor-text-node">Foo</span><span class="style-token style-operator">&gt;</span><span class="style-token style-operator">&amp;</span><span class="editor-text-node"> pFoo</span><span class="style-token style-punctuation">)</span><span class="style-token style-punctuation">;</span></div></div></div></div></div></foreignObject><text x="522" y="239" fill="#000000" font-family="Helvetica" font-size="12px">MutexLock mutex; // No need for ReaderWriterLock...</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 368px; height: 1px; padding-top: 7px; margin-left: 952px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;"><pre style="background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &quot;jetbrains mono&quot; , monospace ; font-size: 9.8pt"><span style="color: #cc7832">class </span><span style="color: #b5b6e3">Foo<br /></span>{<br /> <span style="color: #cc7832">public</span>:<br />  <span style="color: #cc7832">void </span><span style="color: #ffc66d">doit</span>() <span style="color: #cc7832">const;<br /></span>}<span style="color: #cc7832">;<br /></span><span style="color: #cc7832"><br /></span><span style="color: #cc7832">typedef </span><span style="color: #b5b6e3">std</span>::<span style="color: #b5b6e3">vector</span>&lt;<span style="color: #b5b6e3">Foo</span>&gt; <span style="color: #b9bcd1">FooList</span><span style="color: #cc7832">;<br /></span><span style="color: #cc7832">typedef </span><span style="color: #b5b6e3">std</span>::<span style="color: #b5b6e3">shared_ptr</span>&lt;<span style="color: #b9bcd1">FooList</span>&gt; <span style="color: #b9bcd1">FooListPtr</span><span style="color: #cc7832">;<br /></span><span style="color: #b9bcd1">FooListPtr </span>g_foos<span style="color: #cc7832">;<br /></span><span style="color: #b5b6e3">MutexLock </span>mutex<span style="color: #cc7832">;</span></pre><pre style="background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &quot;jetbrains mono&quot; , monospace ; font-size: 9.8pt"><pre style="font-family: &quot;jetbrains mono&quot; , monospace ; font-size: 9.8pt"><span style="color: #cc7832">void </span><span style="color: #b5b6e3">Foo</span>::<span style="color: #ffc66d">doit</span>() <span style="color: #cc7832">const </span>{<br />    <span style="color: #b5b6e3">Foo </span>f<span style="color: #cc7832">;<br /></span><span style="color: #cc7832">    </span>post(f)<span style="color: #cc7832">;<br /></span>}</pre></pre></div></div></div></foreignObject><text x="952" y="19" fill="#000000" font-family="Helvetica" font-size="12px">class Foo...</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 488px; height: 1px; padding-top: 317px; margin-left: 952px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;"><pre style="background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &quot;jetbrains mono&quot; , monospace ; font-size: 9.8pt"><span style="color: #cc7832">void </span><span style="color: #ffc66d">traverse</span>() // read 操作<br />{<br />  <span style="color: #b9bcd1">FooListPtr </span>foos<span style="color: #cc7832">;<br /></span><span style="color: #cc7832">  </span>{<br />    <span style="color: #b5b6e3">MutexLockGuard </span>lock(mutex)<span style="color: #cc7832">;<br /></span><span style="color: #cc7832">    </span>foos <span style="color: #5f8c8a">= </span>g_foos<span style="color: #cc7832">;<br /></span><span style="color: #cc7832">    </span><span style="color: #908b25">assert</span>(!g_foos.unique())<span style="color: #cc7832">;<br /></span><span style="color: #cc7832">  </span>}<br /><br />  <span style="color: #808080">// assert(!foos.unique()); this may not hold<br /></span><span style="color: #808080"><br /></span><span style="color: #808080">  </span><span style="color: #cc7832">for </span>(<span style="color: #b5b6e3">std</span>::<span style="color: #b5b6e3">vector</span>&lt;<span style="color: #b5b6e3">Foo</span>&gt;::<span style="color: #b9bcd1">const_iterator </span>it = foos<span style="color: #5f8c8a">-&gt;</span>begin()<span style="color: #cc7832">;<br /></span><span style="color: #cc7832">      </span>it <span style="color: #5f8c8a">!= </span>foos<span style="color: #5f8c8a">-&gt;</span>end()<span style="color: #cc7832">; </span><span style="color: #5f8c8a">++</span>it)<br />  {<br />    it<span style="color: #5f8c8a">-&gt;</span>doit()<span style="color: #cc7832">;<br /></span><span style="color: #cc7832">  </span>}<br />}</pre></div></div></div></foreignObject><text x="952" y="329" fill="#000000" font-family="Helvetica" font-size="12px">void traverse() // read 操作...</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 488px; height: 1px; padding-top: 612px; margin-left: 952px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;"><pre style="background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &quot;jetbrains mono&quot; , monospace ; font-size: 9.8pt"><span style="color: #cc7832">void </span><span style="color: #ffc66d">post</span>(<span style="color: #cc7832">const </span><span style="color: #b5b6e3">Foo</span>&amp; f) // write 操作<br />{<br />  printf(<span style="color: #6a8759">"post</span><span style="color: #cc7832">\n</span><span style="color: #6a8759">"</span>)<span style="color: #cc7832">;<br /></span><span style="color: #cc7832">  </span><span style="color: #b5b6e3">MutexLockGuard </span>lock(mutex)<span style="color: #cc7832">;<br /></span><span style="color: #cc7832">  if </span>(!g_foos.unique())<br />  {<br />    g_foos.reset(<span style="color: #cc7832">new </span><span style="color: #b9bcd1">FooList</span>(<span style="color: #5f8c8a">*</span>g_foos))<span style="color: #cc7832">; </span><span style="color: #808080">// </span><span style="color: #808080 ; font-family: &quot;menlo-regular&quot; , monospace">复制了一份原始的数据<br /></span><span style="color: #808080 ; font-family: &quot;menlo-regular&quot; , monospace">    </span>printf(<span style="color: #6a8759">"copy the whole list</span><span style="color: #cc7832">\n</span><span style="color: #6a8759">"</span>)<span style="color: #cc7832">;<br /></span><span style="color: #cc7832">  </span>}<br />  <span style="color: #908b25">assert</span>(g_foos.unique())<span style="color: #cc7832">;<br /></span><span style="color: #cc7832">  </span>g_foos<span style="color: #5f8c8a">-&gt;</span>push_back(f)<span style="color: #cc7832">;<br /></span>}</pre></div></div></div></foreignObject><text x="952" y="624" fill="#000000" font-family="Helvetica" font-size="12px">void post(const Foo&amp; f) // write 操作...</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>